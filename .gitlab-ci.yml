stages:
  - test

ansible-lint:
  image: python:3-slim
  stage: test
  before_script:
    - pip install ansible ansible-lint
    - ansible-lint --version
  script:
    - ansible-lint .

molecule:
  image: supsy/molecule-systemd:base-ansible2.10
  services:
    - docker:dind
  variables:
    DOCKER_HOST: "tcp://docker:2375"
    PY_COLORS: 1
  stage: test
  script:
    - molecule test
  parallel:
    matrix:
      - MOLECULE_OS: 
          - debian9
          - debian10
          - "ubuntu20.04"
  tags:
    - docker